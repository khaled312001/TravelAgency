import{d as s,r as e,c as t,g as i}from"../../../_/nitro.mjs";import{createClient as a}from"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"@iconify/utils";import"node:crypto";import"consola";import"node:module";import"node:url";import"ipx";import"node:fs";import"node:path";const o=s((async s=>{try{const o=await async function(s){const e=i(s,"authorization");if(!e||!e.startsWith("Bearer "))throw t({statusCode:401,statusMessage:"No valid session token provided"});const o=e.substring(7),r="https://ueofktshvaqtxjsxvisv.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb2ZrdHNodmFxdHhqc3h2aXN2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTkyMzE3NiwiZXhwIjoyMDc1NDk5MTc2fQ.8x1bRWz6UgyRgkMQf5c32qABhgRNnY-p8Q2Sz9S-jn0",d=a(r,n),{data:c,error:p}=await d.from("admin_sessions").select("\n      admin_user_id,\n      expires_at,\n      admin_users (\n        id,\n        email,\n        name,\n        role\n      )\n    ").eq("session_token",o).single();if(p||!c)throw t({statusCode:401,statusMessage:"Invalid session"});const u=new Date,m=new Date(c.expires_at);if(u>m)throw t({statusCode:401,statusMessage:"Session expired"});return c.admin_users}(s),r=await e(s),n=a("https://ueofktshvaqtxjsxvisv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb2ZrdHNodmFxdHhqc3h2aXN2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTkyMzE3NiwiZXhwIjoyMDc1NDk5MTc2fQ.8x1bRWz6UgyRgkMQf5c32qABhgRNnY-p8Q2Sz9S-jn0"),{title:d,description:c,price:p,duration_days:u,destination:m,image_url:I}=r;if(!(d&&c&&p&&u&&m&&I))throw t({statusCode:400,statusMessage:"All fields are required"});const{data:l,error:h}=await n.from("packages").insert({title:d,description:c,price:parseFloat(p),duration_days:parseInt(u),destination:m,image_url:I}).select().single();if(h)throw t({statusCode:500,statusMessage:"Failed to create package"});return await n.from("admin_activity_logs").insert({admin_user_id:o.id,action:"create_package",resource_type:"package",resource_id:l.id,details:{title:l.title},ip_address:getClientIP(s),user_agent:i(s,"user-agent")}),{success:!0,data:l}}catch(s){if(console.error("Package creation error:",s),s.statusCode)throw s;throw t({statusCode:500,statusMessage:"Internal server error"})}}));export{o as default};
//# sourceMappingURL=index.post.mjs.map
