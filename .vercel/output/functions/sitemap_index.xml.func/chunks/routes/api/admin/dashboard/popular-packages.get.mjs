import{d as s,c as t,g as e}from"../../../../_/nitro.mjs";import{createClient as i}from"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"@iconify/utils";import"node:crypto";import"consola";import"node:module";import"node:url";import"ipx";import"node:fs";import"node:path";const o=s((async s=>{try{await async function(s){const o=e(s,"authorization");if(!o||!o.startsWith("Bearer "))throw t({statusCode:401,statusMessage:"No valid session token provided"});const a=o.substring(7),r="https://ueofktshvaqtxjsxvisv.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb2ZrdHNodmFxdHhqc3h2aXN2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTkyMzE3NiwiZXhwIjoyMDc1NDk5MTc2fQ.8x1bRWz6UgyRgkMQf5c32qABhgRNnY-p8Q2Sz9S-jn0",c=i(r,n),{data:p,error:d}=await c.from("admin_sessions").select("expires_at").eq("session_token",a).single();if(d||!p)throw t({statusCode:401,statusMessage:"Invalid session"});const m=new Date,I=new Date(p.expires_at);if(m>I)throw t({statusCode:401,statusMessage:"Session expired"})}(s);const o=i("https://ueofktshvaqtxjsxvisv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb2ZrdHNodmFxdHhqc3h2aXN2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTkyMzE3NiwiZXhwIjoyMDc1NDk5MTc2fQ.8x1bRWz6UgyRgkMQf5c32qABhgRNnY-p8Q2Sz9S-jn0"),{data:a,error:r}=await o.from("packages").select("id, title, price, image_url").order("created_at",{ascending:!1}).limit(5);if(r)throw t({statusCode:500,statusMessage:"Failed to fetch packages"});return(null==a?void 0:a.map((s=>({id:s.id,title:s.title,price:s.price,views:Math.floor(200*Math.random())+50,image_url:s.image_url}))))||[]}catch(s){if(console.error("Popular packages error:",s),s.statusCode)throw s;throw t({statusCode:500,statusMessage:"Internal server error"})}}));export{o as default};
//# sourceMappingURL=popular-packages.get.mjs.map
