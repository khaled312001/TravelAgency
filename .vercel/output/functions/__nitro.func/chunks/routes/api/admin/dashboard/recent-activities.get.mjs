import{d as t,c as e,g as s}from"../../../../_/nitro.mjs";import{createClient as i}from"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"@iconify/utils";import"node:crypto";import"consola";import"node:module";import"node:url";import"ipx";import"node:fs";import"node:path";const a=t((async t=>{try{await async function(t){const a=s(t,"authorization");if(!a||!a.startsWith("Bearer "))throw e({statusCode:401,statusMessage:"No valid session token provided"});const o=a.substring(7),n="https://ueofktshvaqtxjsxvisv.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb2ZrdHNodmFxdHhqc3h2aXN2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTkyMzE3NiwiZXhwIjoyMDc1NDk5MTc2fQ.8x1bRWz6UgyRgkMQf5c32qABhgRNnY-p8Q2Sz9S-jn0",r=i(n,c),{data:d,error:p}=await r.from("admin_sessions").select("expires_at").eq("session_token",o).single();if(p||!d)throw e({statusCode:401,statusMessage:"Invalid session"});const m=new Date,g=new Date(d.expires_at);if(m>g)throw e({statusCode:401,statusMessage:"Session expired"})}(t);const a=i("https://ueofktshvaqtxjsxvisv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb2ZrdHNodmFxdHhqc3h2aXN2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTkyMzE3NiwiZXhwIjoyMDc1NDk5MTc2fQ.8x1bRWz6UgyRgkMQf5c32qABhgRNnY-p8Q2Sz9S-jn0"),{data:o,error:n}=await a.from("admin_activity_logs").select("action, created_at, details").order("created_at",{ascending:!1}).limit(10);if(n)throw e({statusCode:500,statusMessage:"Failed to fetch activities"});const c=(null==o?void 0:o.map((t=>({id:t.created_at,action:t.action,description:getActivityDescription(t.action,t.details),timestamp:t.created_at,type:getActivityType(t.action)}))))||[];return 0===c.length?[{id:"1",action:"create_package",description:"تم إنشاء حزمة جديدة",timestamp:new Date(Date.now()-72e5).toISOString(),type:"package"},{id:"2",action:"new_message",description:"رسالة جديدة من العميل",timestamp:new Date(Date.now()-144e5).toISOString(),type:"message"}]:c}catch(t){if(console.error("Recent activities error:",t),t.statusCode)throw t;throw e({statusCode:500,statusMessage:"Internal server error"})}}));function getActivityDescription(t,e){return{login:"تم تسجيل الدخول",logout:"تم تسجيل الخروج",create_package:"تم إنشاء حزمة جديدة",update_package:"تم تحديث حزمة",delete_package:"تم حذف حزمة",create_destination:"تم إنشاء وجهة جديدة",update_destination:"تم تحديث وجهة",delete_destination:"تم حذف وجهة",new_booking:"حجز جديد",update_booking:"تم تحديث حجز",new_message:"رسالة جديدة من العميل",reply_message:"تم الرد على رسالة"}[t]||`نشاط: ${t}`}function getActivityType(t){return t.includes("package")?"package":t.includes("booking")?"booking":t.includes("message")?"message":t.includes("destination")?"destination":"message"}export{a as default};
//# sourceMappingURL=recent-activities.get.mjs.map
