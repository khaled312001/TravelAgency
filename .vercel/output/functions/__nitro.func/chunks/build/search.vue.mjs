import{ref as e,computed as a,defineComponent as r,withAsyncContext as t,watch as n,mergeProps as l,unref as i,useSSRContext as o}from"vue";import{ssrRenderAttrs as s,ssrRenderComponent as u,ssrInterpolate as d,ssrRenderList as v}from"vue/server-renderer";import{useRoute as c,useRouter as m}from"vue-router";import{m as p,d as g}from"./usePackages.mjs";import{g as x,I as f}from"./server.mjs";import{G as h}from"./NuxtImg.vue2.mjs";import{Z as b}from"./PackageCard.vue2.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"node:crypto";import"consola";import"node:module";import"node:url";import"ipx";import"node:fs";import"node:path";import"@supabase/ssr";import"@iconify/vue";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"unhead/utils";import"devalue";import"unhead/plugins";import"@unhead/schema-org";import"@unhead/schema-org/vue";import"floating-vue";import"@iconify/utils/lib/css/icon";import"./nuxt-link.mjs";const w=r({__name:"search",__ssrInlineRender:!0,async setup(r){let o,w;c();const y=m(),{t:$,locale:_}=x(),{getPackages:R}=p(),{filters:L,searchQuery:j,filterOptions:k}=(()=>{const{locale:r}=x(),{getPackages:t}=p(),n=e(""),l=e({periods:[],priceRange:{min:0,max:1/0},duration:{min:0,max:1/0},dates:{start:null,end:null},travelers:1,type:[]}),i=a((()=>t())),o=a((()=>{const e=i.value||[];if(0===e.length)return{periods:[],priceRanges:[],durationRanges:[]};const a=new Set;e.forEach((e=>{e.travel_period&&a.add(e.travel_period)}));const r=["january","february","march","april","may","june","july","august","september","october","november","december"],t=Array.from(a).sort(((e,a)=>r.findIndex((a=>e.toLowerCase().includes(a)))-r.findIndex((e=>a.toLowerCase().includes(e))))),n={january:{en:"January",ar:"يناير"},february:{en:"February",ar:"فبراير"},march:{en:"March",ar:"مارس"},april:{en:"April",ar:"أبريل"},may:{en:"May",ar:"مايو"},june:{en:"June",ar:"يونيو"},july:{en:"July",ar:"يوليو"},august:{en:"August",ar:"أغسطس"},september:{en:"September",ar:"سبتمبر"},october:{en:"October",ar:"أكتوبر"},november:{en:"November",ar:"نوفمبر"},december:{en:"December",ar:"ديسمبر"}};return{periods:t.map((e=>({id:e,name:n[e]||{en:e,ar:e}}))),priceRanges:[{min:0,max:1e3,label:"Under $1,000"},{min:1e3,max:3e3,label:"$1,000 - $3,000"},{min:3e3,max:5e3,label:"$3,000 - $5,000"},{min:5e3,max:1/0,label:"Over $5,000"}],durationRanges:[{min:0,max:3,label:"1-3 days"},{min:4,max:7,label:"4-7 days"},{min:8,max:14,label:"8-14 days"},{min:15,max:1/0,label:"15+ days"}]}})),s=a((()=>{let e=i.value||[];if(n.value){const a=n.value.toLowerCase();e=e.filter((e=>e.title_en.toLowerCase().includes(a)||e.description_en.toLowerCase().includes(a)))}return l.value.periods.length>0&&(e=e.filter((e=>l.value.periods.some((a=>e.travel_period.toLowerCase()===a.toLowerCase()))))),(l.value.priceRange.min>0||l.value.priceRange.max<1/0)&&(e=e.filter((e=>e.price>=l.value.priceRange.min&&e.price<=l.value.priceRange.max))),(l.value.duration.min>0||l.value.duration.max<1/0)&&(e=e.filter((e=>e.duration_days>=l.value.duration.min&&e.duration_days<=l.value.duration.max))),e})),u=a((()=>{let e=0;return e+=l.value.periods.length,(0!==l.value.priceRange.min||l.value.priceRange.max!==1/0)&&e++,(0!==l.value.duration.min||l.value.duration.max!==1/0)&&e++,l.value.dates.start&&l.value.dates.end&&e++,l.value.travelers>1&&e++,e}));return{searchQuery:n,filters:l,filterOptions:o,filteredPackages:s,activeFiltersCount:u,resetFilters:()=>{n.value="",l.value={periods:[],priceRange:{min:0,max:1/0},duration:{min:0,max:1/0},dates:{start:null,end:null},travelers:1,type:[]}}}})(),{data:C,pending:M,error:z}=([o,w]=t((()=>f("packages",(()=>R()),{default:()=>[]}))),o=await o,w(),o),S=a((()=>{var e;return null!=(e=L.value)&&e.destinations?L.value.destinations.map((e=>{var a,r,t;const n=null==(r=null==(a=k.value)?void 0:a.destinations)?void 0:r.find((a=>a.id===e));return(null==(t=null==n?void 0:n.name)?void 0:t[_.value])||e})):[]})),P=a((()=>{var e,a,r,t,n;return!!L.value&&(((null==(e=L.value.destinations)?void 0:e.length)||0)>0||0!==((null==(a=L.value.priceRange)?void 0:a.min)||0)||((null==(r=L.value.priceRange)?void 0:r.max)||1/0)!==1/0||0!==((null==(t=L.value.duration)?void 0:t.min)||0)||((null==(n=L.value.duration)?void 0:n.max)||1/0)!==1/0||(L.value.travelers||1)>1)})),A=a((()=>C.value?C.value.filter((e=>{var a,r,t,n,l,i,o,s,u,d,v,c,m,p,g,x;if(j.value){const l=j.value.toLowerCase(),i=(null==(a=e.title_en)?void 0:a.toLowerCase().includes(l))||(null==(r=e.title_ar)?void 0:r.toLowerCase().includes(l)),o=(null==(t=e.description_en)?void 0:t.toLowerCase().includes(l))||(null==(n=e.description_ar)?void 0:n.toLowerCase().includes(l));if(!i&&!o)return!1}if((null==(i=null==(l=L.value)?void 0:l.destinations)?void 0:i.length)>0){const a=null==(o=null==e?void 0:e.travel_period)?void 0:o.toLowerCase();if(!a||!L.value.destinations.some((e=>{const r=e.toLowerCase();return a.includes(r)})))return!1}return!((null==e?void 0:e.price_per_person)<((null==(u=null==(s=L.value)?void 0:s.priceRange)?void 0:u.min)||0)||(null==(v=null==(d=L.value)?void 0:d.priceRange)?void 0:v.max)!==1/0&&(null==e?void 0:e.price_per_person)>L.value.priceRange.max||(null==e?void 0:e.duration_days)<((null==(m=null==(c=L.value)?void 0:c.duration)?void 0:m.min)||0)||(null==(g=null==(p=L.value)?void 0:p.duration)?void 0:g.max)!==1/0&&(null==e?void 0:e.duration_days)>L.value.duration.max||((null==(x=L.value)?void 0:x.travelers)||1)>1&&(null==e?void 0:e.max_persons)<L.value.travelers)})):[]));return n([L,j],(([e,a])=>{var r;y.replace({query:{...a&&{q:a},...(null==(r=e.destinations)?void 0:r.length)&&{periods:e.destinations.join(",")},...e.priceRange.min>0&&{priceMin:e.priceRange.min},...e.priceRange.max<1/0&&{priceMax:e.priceRange.max},...e.duration.min>0&&{durationMin:e.duration.min},...e.duration.max<1/0&&{durationMax:e.duration.max},...e.travelers>1&&{travelers:e.travelers}}})}),{deep:!0}),(e,a,r,t)=>{var n;const o=h;a(`<div${s(l({class:"min-h-screen bg-gray-50"},t))}><section class="relative bg-cover bg-center py-20"><div class="absolute inset-0">`),a(u(o,{src:"/images/packages/home/packages-hero-bg.jpeg",alt:"Stunning beachfront villa with private pool and ocean views",width:"1920",height:"1080",loading:"eager",format:"webp",quality:"90",class:"w-full h-full object-cover",placeholder:""},null,r)),a(`<div class="absolute inset-0 bg-gradient-to-b from-black/50 via-black/30 to-black/50"></div></div><div class="container relative z-10 mx-auto px-4 text-center text-white"><h1 class="text-2xl md:text-3xl font-bold mb-4">${d(i($)("search.results.title"))}</h1><div class="flex items-center justify-center text-1xl gap-2 text-sm md:text-base mb-6 w-full">`),A.value.length>0?a(`<span>${d(i($)("search.results.count",{count:A.value.length}))}</span>`):a(`<span>${d(i($)("search.results.empty"))}</span>`),a('</div><div class="flex flex-wrap justify-center gap-3 mb-8">'),null!=(n=i(L))&&n.destinations&&i(L).destinations.length?a(`<div class="flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg><span>${d(S.value.join(", "))}</span></div>`):a("\x3c!----\x3e"),0!==i(L).priceRange.min||i(L).priceRange.max!==1/0?(a('<div class="flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full">'),a(u(g,{size:20,class:"text-white"},null,r)),a(`<span>${d((e=>e.max===1/0?`${$("common.from")} ${e.min.toLocaleString()}`:`${e.min.toLocaleString()} - ${e.max.toLocaleString()}`)(i(L).priceRange))}</span></div>`)):a("\x3c!----\x3e"),0!==i(L).duration.min||i(L).duration.max!==1/0?a(`<div class="flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg><span>${d((e=>e.max===1/0?`${$("common.from")} ${e.min} ${$("common.days")}`:`${e.min} - ${e.max} ${$("common.days")}`)(i(L).duration))}</span></div>`):a("\x3c!----\x3e"),i(L).travelers>1?a(`<div class="flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path></svg><span>${d(i(L).travelers)} ${d(i($)("search.travelers_count",{count:i(L).travelers}))}</span></div>`):a("\x3c!----\x3e"),P.value?a(`<button class="flex items-center gap-2 bg-primary/20 hover:bg-primary/30 backdrop-blur-sm px-4 py-2 rounded-full transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> ${d(i($)("search.active_filters.clear_filters"))}</button>`):a("\x3c!----\x3e"),a('</div></div></section><section class="py-16"><div class="container mx-auto px-4">'),i(M)?a('<div class="flex justify-center items-center min-h-[400px]"><div class="animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"></div></div>'):i(z)?a(`<div class="text-center text-red-500">${d(i($)("common.error"))}</div>`):0===A.value.length?a(`<div class="text-center"><p class="text-xl text-gray-600">${d(i($)("search.results.empty"))}</p><button class="mt-4 px-6 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors">${d(i($)("search.actions.clear_filters"))}</button></div>`):(a('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">\x3c!--[--\x3e'),v(A.value,(e=>{a(u(b,{key:e.id,package_:e},null,r))})),a("\x3c!--]--\x3e</div>")),a("</div></section></div>")}}}),y=w.setup;w.setup=(e,a)=>{const r=o();return(r.modules||(r.modules=new Set)).add("pages/packages/search.vue"),y?y(e,a):void 0};export{w as default};
//# sourceMappingURL=search.vue.mjs.map
