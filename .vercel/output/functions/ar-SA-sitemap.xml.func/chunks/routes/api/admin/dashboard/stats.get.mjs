import{d as t,c as e,g as o}from"../../../../_/nitro.mjs";import{createClient as s}from"@supabase/supabase-js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"@iconify/utils";import"node:crypto";import"consola";import"node:module";import"node:url";import"ipx";import"node:fs";import"node:path";const a=t((async t=>{try{await async function(t){const a=o(t,"authorization");if(!a||!a.startsWith("Bearer "))throw e({statusCode:401,statusMessage:"No valid session token provided"});const i=a.substring(7),n="https://ueofktshvaqtxjsxvisv.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb2ZrdHNodmFxdHhqc3h2aXN2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTkyMzE3NiwiZXhwIjoyMDc1NDk5MTc2fQ.8x1bRWz6UgyRgkMQf5c32qABhgRNnY-p8Q2Sz9S-jn0",r=s(n,c),{data:d,error:u}=await r.from("admin_sessions").select("expires_at").eq("session_token",i).single();if(u||!d)throw e({statusCode:401,statusMessage:"Invalid session"});const m=new Date,p=new Date(d.expires_at);if(m>p)throw e({statusCode:401,statusMessage:"Session expired"})}(t);const a=s("https://ueofktshvaqtxjsxvisv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb2ZrdHNodmFxdHhqc3h2aXN2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTkyMzE3NiwiZXhwIjoyMDc1NDk5MTc2fQ.8x1bRWz6UgyRgkMQf5c32qABhgRNnY-p8Q2Sz9S-jn0"),[i,n,c,r,d,u,m,p,l]=await Promise.all([a.from("package_inquiries").select("id",{count:"exact",head:!0}),a.from("package_inquiries").select("id",{count:"exact",head:!0}).gte("created_at",new Date(Date.now()-6048e5).toISOString()),a.from("destinations").select("id",{count:"exact",head:!0}),a.from("packages").select("id",{count:"exact",head:!0}),a.from("bookings").select("id",{count:"exact",head:!0}),a.from("bookings").select("id",{count:"exact",head:!0}).eq("status","pending"),a.from("bookings").select("id",{count:"exact",head:!0}).eq("status","confirmed"),a.from("bookings").select("id",{count:"exact",head:!0}).eq("status","cancelled"),a.from("bookings").select("id",{count:"exact",head:!0}).eq("status","completed")]),h=await a.from("destination_inquiries").select("id",{count:"exact",head:!0}).gte("created_at",new Date(Date.now()-6048e5).toISOString()),I=(n.count||0)+(h.count||0);return{totalUsers:i.count||0,newMessages:I,totalDestinations:c.count||0,totalPackages:r.count||0,totalBookings:d.count||0,pendingBookings:u.count||0,confirmedBookings:m.count||0,cancelledBookings:p.count||0,completedBookings:l.count||0}}catch(t){if(console.error("Dashboard stats error:",t),t.statusCode)throw t;throw e({statusCode:500,statusMessage:"Internal server error"})}}));export{a as default};
//# sourceMappingURL=stats.get.mjs.map
